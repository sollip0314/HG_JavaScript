<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script>
    /*
    localStorage.getItem('키')
    localStorage.setItem('키', '값')
    localStorage.removeItem('키')
    localStorage.clear() //전체 제거
    */

    const load = () => {
      const data = localStorage.getItem('애플리케이션');
      if (data !== null) {
        try {
          // 유효한 JSON인지 시도
          return JSON.parse(data); 
        } catch (e) {
        // 파싱 실패 시 기본값 반환
          console.error("Failed to parse localStorage data:", e);
          return {color : 'red', message : ''}
        }
      } else {
        // 저장된 데이터가 없을 경우 기본값 반환
        return {color : 'red', message : ''};
        }
      }

    const save = (data) => {
      localStorage.setItem('애플리케이션', JSON.stringify(data))
      //localStorage.setItem('애플리케이션', `${data.color},${data.message}`)
    }

    document.addEventListener('DOMContentLoaded', () => {
     const p = document.querySelector('p')
     const button = document.querySelector('button')
     const input =  document.querySelector('input')
     const select = document.querySelector('select')

     // 초기 실행
     const data = load()
     p.textContent = `이전 실행 때의 마지막 값 : ${data.message}`
     input.value = data.message
     document.body.style.backgroundColor = data.color
     select.value = data.color     
     
     // 이벤트 연결
     button.addEventListener('click', () => {
      // 데이터를 모두 지우고!
      data.color = 'red'
      data.message = ''
      save(data)

      // 화면에 초기화된 상태 반영 ⭐️
      input.value = ''
      document.body.style.backgroundColor = data.color // 'red'로 설정
      p.textContent = `이전 실행 때의 마지막 값 : ${data.message}` // 메시지 업데이트
      // localStorage.clear()
     })

     input.addEventListener('keyup', () => {
      data.message = input.value
      save(data)
     })
      
     select.addEventListener('change', () =>{
      const color = select.options[select.selectedIndex].value
      // 입력양식 반영
      document.body.style.backgroundColor = color   //localStorage.setItem('칼라', color)      
      // 데이터를 저장
      data.color = color
      save(data)
     })
    })     
  </script>
</head>
<body>
  <p></p>
  <button>지우기</button>
  <input type="text" name="" id="">
  <select name = "" id="">
    <option value="red">빨간색</option>
    <option value="blue">파란색</option>
    <option value="green">초록색</option>
  </select>
</body>
</html>